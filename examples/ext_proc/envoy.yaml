node:
  cluster: moego-gateway
  id: master

admin:
  address:
    socket_address:
      protocol: TCP
      address: 0.0.0.0
      port_value: 9901

dynamic_resources:
  cds_config:
    path: ./cluster.yaml
    resource_api_version: V3
  lds_config:
    path: ./listener.yaml
    resource_api_version: V3

overload_manager:
  refresh_interval: 0.25s
  resource_monitors:
    - name: 'envoy.resource_monitors.fixed_heap'
      typed_config:
        '@type': type.googleapis.com/envoy.extensions.resource_monitors.fixed_heap.v3.FixedHeapConfig
        max_heap_size_bytes: 4294967296 # 4 GiB, access log with body
  actions:
    - name: 'envoy.overload_actions.shrink_heap'
      triggers:
        - name: 'envoy.resource_monitors.fixed_heap'
          threshold:
            value: 0.95
    - name: 'envoy.overload_actions.stop_accepting_requests'
      triggers:
        - name: 'envoy.resource_monitors.fixed_heap'
          threshold:
            value: 0.98

layered_runtime:
  layers:
    - name: static_layer_0
      static_layer:
        envoy:
          resource_limits:
            listener:
              external_http:
                connection_limit: 10000
              external_https:
                connection_limit: 10000
        overload:
          global_downstream_max_connections: 50000